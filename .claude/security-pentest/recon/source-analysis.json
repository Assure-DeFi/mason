{
  "framework": {
    "name": "Next.js",
    "version": "14.2.29",
    "database": "Supabase (PostgreSQL)",
    "auth": "NextAuth.js 4.24.5 with GitHub OAuth"
  },
  "auth_patterns": [
    {
      "file": "src/app/api/health/route.ts",
      "type": "none",
      "protected": false,
      "notes": "Public health endpoint - by design for monitoring"
    },
    {
      "file": "src/app/api/docs/openapi.json/route.ts",
      "type": "none",
      "protected": false,
      "notes": "Public OpenAPI spec endpoint"
    },
    {
      "file": "src/app/api/v1/backlog/next/route.ts",
      "type": "api_key_check",
      "protected": true,
      "notes": "CLI API key + rate limiting"
    },
    {
      "file": "src/app/api/v1/backlog/update-status/route.ts",
      "type": "api_key_check",
      "protected": true,
      "notes": "CLI API key + rate limiting"
    },
    {
      "file": "src/app/api/v1/backlog/submit/route.ts",
      "type": "api_key_check",
      "protected": true,
      "notes": "CLI API key + rate limiting"
    },
    {
      "file": "src/app/api/v1/execution/route.ts",
      "type": "api_key_check",
      "protected": true,
      "notes": "CLI API key + rate limiting"
    },
    {
      "file": "src/app/api/v1/execution/update/route.ts",
      "type": "api_key_check",
      "protected": true,
      "notes": "CLI API key + rate limiting"
    },
    {
      "file": "src/app/api/v1/execution/logs/route.ts",
      "type": "api_key_check",
      "protected": true,
      "notes": "CLI API key + rate limiting"
    },
    {
      "file": "src/app/api/account/delete/route.ts",
      "type": "getServerSession",
      "protected": true,
      "notes": "Cascading user delete"
    },
    {
      "file": "src/app/api/admin/stats/route.ts",
      "type": "getServerSession",
      "protected": true,
      "notes": "Admin-only stats"
    },
    {
      "file": "src/app/api/setup/migrations/route.ts",
      "type": "getServerSession",
      "protected": true,
      "notes": "DB schema modification"
    },
    {
      "file": "src/app/api/keys/route.ts",
      "type": "getServerSession",
      "protected": true,
      "notes": "API key management"
    },
    {
      "file": "src/app/api/github/repositories/route.ts",
      "type": "getServerSession",
      "protected": true,
      "notes": "Repo management"
    },
    {
      "file": "src/app/api/supabase/projects/[ref]/query/route.ts",
      "type": "getServerSession",
      "protected": true,
      "notes": "SQL query proxy - proxies arbitrary SQL with user's bearer token"
    },
    {
      "file": "src/app/api/backlog/route.ts",
      "type": "getServerSession",
      "protected": true,
      "notes": "Backlog items - accepts client Supabase credentials via headers"
    }
  ],
  "database_queries": [
    {
      "file": "src/app/api/v1/backlog/next/route.ts",
      "line": 0,
      "type": "supabase",
      "parameterized": true,
      "user_input_flows_in": true,
      "input_source": "API key -> user_id lookup -> .eq()",
      "risk": "none"
    },
    {
      "file": "src/app/api/v1/backlog/submit/route.ts",
      "line": 0,
      "type": "supabase",
      "parameterized": true,
      "user_input_flows_in": true,
      "input_source": "request body fields -> .insert()",
      "risk": "none"
    },
    {
      "file": "src/app/api/v1/backlog/update-status/route.ts",
      "line": 0,
      "type": "supabase",
      "parameterized": true,
      "user_input_flows_in": true,
      "input_source": "request body status -> .update()",
      "risk": "none"
    },
    {
      "file": "src/app/api/keys/route.ts",
      "line": 0,
      "type": "supabase",
      "parameterized": true,
      "user_input_flows_in": false,
      "input_source": null,
      "risk": "none"
    },
    {
      "file": "src/app/api/supabase/projects/[ref]/query/route.ts",
      "line": 0,
      "type": "raw_sql",
      "parameterized": false,
      "user_input_flows_in": true,
      "input_source": "request body SQL query -> Supabase Management API",
      "risk": "medium"
    }
  ],
  "input_sources": [
    {
      "file": "src/app/api/v1/backlog/submit/route.ts",
      "line": 0,
      "type": "body",
      "field": "items array (title, description, type, area, etc.)",
      "sanitized": true,
      "flows_to": ["database"]
    },
    {
      "file": "src/app/api/v1/backlog/update-status/route.ts",
      "line": 0,
      "type": "body",
      "field": "item_id, status",
      "sanitized": true,
      "flows_to": ["database"]
    },
    {
      "file": "src/app/api/v1/execution/route.ts",
      "line": 0,
      "type": "body",
      "field": "execution run data",
      "sanitized": true,
      "flows_to": ["database"]
    },
    {
      "file": "src/app/api/backlog/route.ts",
      "line": 0,
      "type": "header",
      "field": "x-supabase-url, x-supabase-anon-key",
      "sanitized": false,
      "flows_to": ["database"]
    },
    {
      "file": "src/app/api/supabase/projects/[ref]/query/route.ts",
      "line": 0,
      "type": "body",
      "field": "query (SQL string)",
      "sanitized": false,
      "flows_to": ["database"]
    },
    {
      "file": "src/app/api/auth/[...nextauth]/route.ts",
      "line": 0,
      "type": "query",
      "field": "callbackUrl",
      "sanitized": true,
      "flows_to": ["redirect"]
    }
  ],
  "dangerous_sinks": [
    {
      "file": "src/app/api/supabase/projects/[ref]/query/route.ts",
      "line": 0,
      "type": "sql_proxy",
      "user_controlled_input": true,
      "risk": "medium"
    }
  ],
  "data_flows": [
    {
      "source": "request body SQL in src/app/api/supabase/projects/[ref]/query/route.ts",
      "processing": "none - passed through to Supabase Management API",
      "sink": "Supabase Management API /sql endpoint",
      "risk_category": "injection",
      "risk_level": "medium"
    },
    {
      "source": "x-supabase-url header in backlog API routes",
      "processing": "used to construct Supabase client",
      "sink": "createClient(url, key) for database operations",
      "risk_category": "injection",
      "risk_level": "low"
    },
    {
      "source": "callbackUrl in auth flow",
      "processing": "validated by validateReturnTo() whitelist",
      "sink": "redirect()",
      "risk_category": "path_traversal",
      "risk_level": "none"
    }
  ]
}
