{
  "api_routes": [
    {
      "path": "/api/health",
      "file": "src/app/api/health/route.ts",
      "methods": ["GET"],
      "auth_required": false,
      "auth_method": "none",
      "parameters": [],
      "returns_sensitive_data": true,
      "notes": "Returns DLQ metrics and system health without auth"
    },
    {
      "path": "/api/docs/openapi.json",
      "file": "src/app/api/docs/openapi.json/route.ts",
      "methods": ["GET"],
      "auth_required": false,
      "auth_method": "none",
      "parameters": [],
      "returns_sensitive_data": false,
      "notes": "Public OpenAPI spec - has wildcard CORS (Access-Control-Allow-Origin: *)"
    },
    {
      "path": "/api/auth/[...nextauth]",
      "file": "src/app/api/auth/[...nextauth]/route.ts",
      "methods": ["GET", "POST"],
      "auth_required": false,
      "auth_method": "none",
      "parameters": [
        {
          "name": "callbackUrl",
          "source": "query",
          "type": "string",
          "validated": true
        }
      ],
      "returns_sensitive_data": false,
      "notes": "NextAuth handler with GitHub OAuth, PKCE+CSRF protection"
    },
    {
      "path": "/api/keys",
      "file": "src/app/api/keys/route.ts",
      "methods": ["GET", "POST", "DELETE"],
      "auth_required": true,
      "auth_method": "getServerSession",
      "parameters": [
        {
          "name": "name",
          "source": "body",
          "type": "string",
          "validated": true
        }
      ],
      "returns_sensitive_data": true,
      "notes": "API key CRUD - keys hashed with SHA-256 before storage"
    },
    {
      "path": "/api/account/delete",
      "file": "src/app/api/account/delete/route.ts",
      "methods": ["POST"],
      "auth_required": true,
      "auth_method": "getServerSession",
      "parameters": [],
      "returns_sensitive_data": false,
      "notes": "Cascading delete of all user data"
    },
    {
      "path": "/api/admin/stats",
      "file": "src/app/api/admin/stats/route.ts",
      "methods": ["GET"],
      "auth_required": true,
      "auth_method": "getServerSession",
      "parameters": [],
      "returns_sensitive_data": true,
      "notes": "Admin-only stats - should verify admin role"
    },
    {
      "path": "/api/setup/migrations",
      "file": "src/app/api/setup/migrations/route.ts",
      "methods": ["POST"],
      "auth_required": true,
      "auth_method": "getServerSession",
      "parameters": [
        {
          "name": "x-supabase-url",
          "source": "header",
          "type": "string",
          "validated": false
        },
        {
          "name": "x-supabase-anon-key",
          "source": "header",
          "type": "string",
          "validated": false
        }
      ],
      "returns_sensitive_data": false,
      "notes": "Runs DB migrations on user's Supabase instance"
    },
    {
      "path": "/api/github/repositories",
      "file": "src/app/api/github/repositories/route.ts",
      "methods": ["GET", "POST"],
      "auth_required": true,
      "auth_method": "getServerSession",
      "parameters": [
        {
          "name": "repositories",
          "source": "body",
          "type": "array",
          "validated": true
        }
      ],
      "returns_sensitive_data": false,
      "notes": "Connect/disconnect GitHub repos"
    },
    {
      "path": "/api/supabase/projects",
      "file": "src/app/api/supabase/projects/route.ts",
      "methods": ["GET"],
      "auth_required": true,
      "auth_method": "getServerSession",
      "parameters": [],
      "returns_sensitive_data": true,
      "notes": "Lists user's Supabase projects"
    },
    {
      "path": "/api/supabase/projects/[ref]/query",
      "file": "src/app/api/supabase/projects/[ref]/query/route.ts",
      "methods": ["POST"],
      "auth_required": true,
      "auth_method": "getServerSession",
      "parameters": [
        {
          "name": "query",
          "source": "body",
          "type": "string",
          "validated": false
        },
        {
          "name": "ref",
          "source": "params",
          "type": "string",
          "validated": false
        }
      ],
      "returns_sensitive_data": true,
      "notes": "Proxies arbitrary SQL to Supabase Management API - no query validation"
    },
    {
      "path": "/api/backlog",
      "file": "src/app/api/backlog/route.ts",
      "methods": ["GET", "POST", "PUT", "DELETE"],
      "auth_required": true,
      "auth_method": "getServerSession",
      "parameters": [
        {
          "name": "x-supabase-url",
          "source": "header",
          "type": "string",
          "validated": false
        },
        {
          "name": "x-supabase-anon-key",
          "source": "header",
          "type": "string",
          "validated": false
        }
      ],
      "returns_sensitive_data": true,
      "notes": "Backlog CRUD - accepts client-side Supabase credentials"
    },
    {
      "path": "/api/v1/backlog/next",
      "file": "src/app/api/v1/backlog/next/route.ts",
      "methods": ["GET"],
      "auth_required": true,
      "auth_method": "api_key",
      "parameters": [],
      "returns_sensitive_data": true,
      "notes": "Get next backlog item for execution - rate limited"
    },
    {
      "path": "/api/v1/backlog/submit",
      "file": "src/app/api/v1/backlog/submit/route.ts",
      "methods": ["POST"],
      "auth_required": true,
      "auth_method": "api_key",
      "parameters": [
        {
          "name": "items",
          "source": "body",
          "type": "array",
          "validated": true
        }
      ],
      "returns_sensitive_data": false,
      "notes": "Submit backlog items from CLI - Zod validated"
    },
    {
      "path": "/api/v1/backlog/update-status",
      "file": "src/app/api/v1/backlog/update-status/route.ts",
      "methods": ["POST"],
      "auth_required": true,
      "auth_method": "api_key",
      "parameters": [
        {
          "name": "item_id",
          "source": "body",
          "type": "string",
          "validated": true
        },
        {
          "name": "status",
          "source": "body",
          "type": "string",
          "validated": true
        }
      ],
      "returns_sensitive_data": false,
      "notes": "Update backlog item status from CLI"
    },
    {
      "path": "/api/v1/execution",
      "file": "src/app/api/v1/execution/route.ts",
      "methods": ["POST"],
      "auth_required": true,
      "auth_method": "api_key",
      "parameters": [
        {
          "name": "execution data",
          "source": "body",
          "type": "object",
          "validated": true
        }
      ],
      "returns_sensitive_data": false,
      "notes": "Create execution run"
    },
    {
      "path": "/api/v1/execution/update",
      "file": "src/app/api/v1/execution/update/route.ts",
      "methods": ["POST"],
      "auth_required": true,
      "auth_method": "api_key",
      "parameters": [
        {
          "name": "run_id",
          "source": "body",
          "type": "string",
          "validated": true
        },
        {
          "name": "status",
          "source": "body",
          "type": "string",
          "validated": true
        }
      ],
      "returns_sensitive_data": false,
      "notes": "Update execution run status"
    },
    {
      "path": "/api/v1/execution/logs",
      "file": "src/app/api/v1/execution/logs/route.ts",
      "methods": ["POST"],
      "auth_required": true,
      "auth_method": "api_key",
      "parameters": [
        { "name": "logs", "source": "body", "type": "array", "validated": true }
      ],
      "returns_sensitive_data": false,
      "notes": "Submit execution logs"
    }
  ],
  "pages": [
    {
      "path": "/",
      "file": "src/app/page.tsx",
      "dynamic_segments": [],
      "uses_search_params": false,
      "client_side_auth": false,
      "server_side_auth": false
    },
    {
      "path": "/auth/signin",
      "file": "src/app/auth/signin/page.tsx",
      "dynamic_segments": [],
      "uses_search_params": true,
      "client_side_auth": false,
      "server_side_auth": false
    },
    {
      "path": "/setup",
      "file": "src/app/setup/page.tsx",
      "dynamic_segments": [],
      "uses_search_params": false,
      "client_side_auth": true,
      "server_side_auth": false
    },
    {
      "path": "/admin/backlog",
      "file": "src/app/admin/backlog/page.tsx",
      "dynamic_segments": [],
      "uses_search_params": false,
      "client_side_auth": true,
      "server_side_auth": false
    },
    {
      "path": "/settings/database",
      "file": "src/app/settings/database/page.tsx",
      "dynamic_segments": [],
      "uses_search_params": false,
      "client_side_auth": true,
      "server_side_auth": false
    },
    {
      "path": "/settings/github",
      "file": "src/app/settings/github/page.tsx",
      "dynamic_segments": [],
      "uses_search_params": false,
      "client_side_auth": true,
      "server_side_auth": false
    },
    {
      "path": "/settings/api-keys",
      "file": "src/app/settings/api-keys/page.tsx",
      "dynamic_segments": [],
      "uses_search_params": false,
      "client_side_auth": true,
      "server_side_auth": false
    },
    {
      "path": "/settings/autopilot",
      "file": "src/app/settings/autopilot/page.tsx",
      "dynamic_segments": [],
      "uses_search_params": false,
      "client_side_auth": true,
      "server_side_auth": false
    }
  ],
  "middleware": {
    "exists": false,
    "file": null,
    "protected_paths": [],
    "notes": "No middleware.ts found - auth is handled per-route"
  },
  "security_headers": {
    "csp": "missing",
    "hsts": "present",
    "x_frame_options": "present",
    "x_content_type_options": "present",
    "referrer_policy": "present",
    "cors": "wildcard on /api/docs/openapi.json only"
  },
  "secrets_exposure": [
    {
      "type": "client_exposure",
      "file": "src/lib/feature-flags.ts",
      "detail": "Admin email hardcoded in source: chapo@assuredefi.com",
      "severity": "low"
    }
  ],
  "attack_surface_summary": {
    "total_api_routes": 17,
    "unprotected_api_routes": 3,
    "total_pages": 8,
    "dynamic_pages": 0,
    "input_vectors": 12
  }
}
